<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hiredis ä½¿ç”¨æŒ‡å—</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f0c29;
            background-image: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #e0e0ff;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(20, 20, 40, 0.8);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(100, 150, 255, 0.3);
        }

        h1 {
            color: #4cd1a8;
            text-shadow: 0 0 10px rgba(76, 209, 168, 0.5);
            border-bottom: 3px solid #4cd1a8;
            padding-bottom: 10px;
            margin-top: 0;
        }

        h2 {
            color: #ff9f7f;
            margin-top: 40px;
        }

        h3 {
            color: #a0a0ff;
            margin-top: 30px;
        }

        p {
            color: #d0d0ff;
        }

        pre {
            background-color: #1a1a2e;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            border-left: 4px solid #4cd1a8;
            margin: 15px 0;
        }

        code {
            font-family: 'Courier New', monospace;
            color: #a0ffa0;
            font-size: 0.95em;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #4cd1a8;
            text-decoration: none;
            font-weight: bold;
            padding: 10px 20px;
            background-color: rgba(76, 209, 168, 0.1);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background-color: rgba(76, 209, 168, 0.2);
            box-shadow: 0 0 10px rgba(76, 209, 168, 0.5);
        }

        .warning {
            background-color: rgba(255, 159, 127, 0.1);
            border-left: 4px solid #ff9f7f;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .note {
            background-color: rgba(76, 209, 168, 0.1);
            border-left: 4px solid #4cd1a8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(76, 209, 168, 0.3);
            text-align: center;
        }

        .footer-text {
            color: #a0a0ff;
            font-size: 0.9em;
            margin: 5px 0;
        }

        .contact-link {
            color: #4cd1a8;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .contact-link:hover {
            color: #ff9f7f;
            text-shadow: 0 0 5px rgba(255, 159, 127, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>

        <h1>hiredis ä½¿ç”¨æŒ‡å—</h1>

        <p>hiredis æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ C è¯­è¨€ Redis å®¢æˆ·ç«¯åº“ï¼Œæä¾›äº†ç®€å•ã€é«˜æ•ˆçš„æ¥å£ã€‚å®ƒæ˜¯ Redis å®˜æ–¹æ¨èçš„ C å®¢æˆ·ç«¯ä¹‹ä¸€ï¼Œä¸“æ³¨äºé«˜æ€§èƒ½å’Œç®€æ´çš„ API è®¾è®¡ã€‚</p>

        <h2>ğŸ“¦ å®‰è£…</h2>

        <h3>Ubuntu/Debian</h3>
        <pre><code>sudo apt-get install libhiredis-dev</code></pre>

        <h3>macOS</h3>
        <pre><code>brew install hiredis</code></pre>

        <h3>ä»æºç ç¼–è¯‘</h3>
        <pre><code>git clone https://github.com/redis/hiredis.git
cd hiredis
make
sudo make install</code></pre>

        <h3>å¤´æ–‡ä»¶</h3>
        <pre><code>#include &lt;hiredis/hiredis.h&gt;</code></pre>

        <h2>ğŸš€ åŸºç¡€ä½¿ç”¨</h2>

        <h3>è¿æ¥ Redis</h3>
        <pre><code>#include &lt;hiredis/hiredis.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main() {
    // è¿æ¥åˆ° Redisï¼ˆé»˜è®¤åœ°å€ 127.0.0.1:6379ï¼‰
    redisContext *c = redisConnect("127.0.0.1", 6379);
    
    if (c == NULL || c->err) {
        if (c) {
            printf("Connection error: %s\n", c->errstr);
            redisFree(c);
        } else {
            printf("Connection error: can't allocate redis context\n");
        }
        return 1;
    }

    printf("Connected to Redis\n");
    
    // æ–­å¼€è¿æ¥
    redisFree(c);
    return 0;
}</code></pre>

        <h3>ç®€å•çš„ SET å’Œ GET</h3>
        <pre><code>#include &lt;hiredis/hiredis.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main() {
    redisContext *c = redisConnect("127.0.0.1", 6379);
    if (c == NULL || c->err) {
        printf("Connection error: %s\n", c->errstr);
        return 1;
    }

    // SET key value
    redisReply *reply = (redisReply *)redisCommand(c, "SET %s %s", "name", "hiredis");
    printf("SET: %s\n", reply->str);
    freeReplyObject(reply);

    // GET key
    reply = (redisReply *)redisCommand(c, "GET %s", "name");
    printf("GET name: %s\n", reply->str);
    freeReplyObject(reply);

    redisFree(c);
    return 0;
}</code></pre>

        <h3>å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®</h3>
        <pre><code>#include &lt;hiredis/hiredis.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main() {
    redisContext *c = redisConnect("127.0.0.1", 6379);
    if (c == NULL || c->err) return 1;

    // å­—ç¬¦ä¸²æ“ä½œ
    redisReply *reply = (redisReply *)redisCommand(c, "SET %s %s", "counter", "100");
    freeReplyObject(reply);

    reply = (redisReply *)redisCommand(c, "INCR %s", "counter");
    printf("INCR counter: %lld\n", reply->integer);
    freeReplyObject(reply);

    // åˆ—è¡¨æ“ä½œ LPUSH
    reply = (redisReply *)redisCommand(c, "LPUSH mylist item1 item2 item3");
    printf("LPUSH: %lld\n", reply->integer);
    freeReplyObject(reply);

    // åˆ—è¡¨æ“ä½œ LRANGE
    reply = (redisReply *)redisCommand(c, "LRANGE mylist 0 -1");
    printf("LRANGE mylist:\n");
    for (size_t i = 0; i &lt; reply->elements; i++) {
        printf("  [%zu]: %s\n", i, reply->element[i]->str);
    }
    freeReplyObject(reply);

    redisFree(c);
    return 0;
}</code></pre>

        <h2>ğŸ” å¸¦å¯†ç è¿æ¥</h2>

        <pre><code>#include &lt;hiredis/hiredis.h&gt;
#include &lt;stdio.h&gt;

int main() {
    // å¸¦å¯†ç è¿æ¥
    redisContext *c = redisConnectWithTimeout(
        "127.0.0.1", 
        6379, 
        (struct timeval){.tv_sec = 2, .tv_usec = 0}
    );

    if (c == NULL || c->err) {
        printf("Connection error: %s\n", c->errstr);
        return 1;
    }

    // è®¤è¯
    redisReply *reply = (redisReply *)redisCommand(c, "AUTH %s", "your_password");
    if (reply->type == REDIS_REPLY_ERROR) {
        printf("AUTH failed: %s\n", reply->str);
    } else {
        printf("AUTH success\n");
    }
    freeReplyObject(reply);

    redisFree(c);
    return 0;
}</code></pre>

        <h2>ğŸ”„ ç®¡é“æ“ä½œ</h2>

        <pre><code>#include &lt;hiredis/hiredis.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main() {
    redisContext *c = redisConnect("127.0.0.1", 6379);
    if (c == NULL || c->err) return 1;

    // å‘é€å¤šä¸ªå‘½ä»¤ä½†ä¸è¯»å–å›å¤
    redisAppendCommand(c, "SET key1 value1");
    redisAppendCommand(c, "SET key2 value2");
    redisAppendCommand(c, "SET key3 value3");
    redisAppendCommand(c, "GET key1");
    redisAppendCommand(c, "GET key2");

    // è¯»å–æ‰€æœ‰å›å¤
    redisReply *reply;
    for (int i = 0; i &lt; 5; i++) {
        redisGetReply(c, (void **)&reply);
        printf("Reply %d: ", i + 1);
        if (reply->type == REDIS_REPLY_STRING) {
            printf("%s\n", reply->str);
        } else if (reply->type == REDIS_REPLY_STATUS) {
            printf("%s\n", reply->str);
        } else {
            printf("(type: %d)\n", reply->type);
        }
        freeReplyObject(reply);
    }

    redisFree(c);
    return 0;
}</code></pre>

        <h2>âš¡ å¼‚æ­¥è¿æ¥</h2>

        <pre><code>#include &lt;hiredis/async.h&gt;
#include &lt;hiredis/adapters/libevent.h&gt;
#include &lt;event2/event.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void connectCallback(const redisAsyncContext *c, int status) {
    if (status != REDIS_OK) {
        printf("Connect error: %s\n", c->errstr);
        return;
    }
    printf("Connected to Redis (async)\n");
}

void disconnectCallback(const redisAsyncContext *c, int status) {
    if (status != REDIS_OK) {
        printf("Disconnect error: %s\n", c->errstr);
        return;
    }
    printf("Disconnected\n");
}

void getCallback(redisAsyncContext *c, void *r, void *privdata) {
    redisReply *reply = (redisReply *)r;
    if (reply == NULL) return;
    
    printf("GET result: %s\n", reply->str);
}

int main() {
    struct event_base *base = event_base_new();

    redisAsyncContext *c = redisAsyncConnect("127.0.0.1", 6379);
    if (c->err) {
        printf("Connection error: %s\n", c->errstr);
        return 1;
    }

    redisLibeventAttach(c, base);
    redisAsyncSetConnectCallback(c, connectCallback);
    redisAsyncSetDisconnectCallback(c, disconnectCallback);

    // å¼‚æ­¥å‘½ä»¤
    redisAsyncCommand(c, NULL, NULL, "SET %s %s", "async_key", "async_value");
    redisAsyncCommand(c, getCallback, NULL, "GET %s", "async_key");

    event_base_dispatch(base);

    event_base_free(base);
    return 0;
}</code></pre>

        <h2>ğŸ“Š å¤„ç†ä¸åŒå›å¤ç±»å‹</h2>

        <pre><code>#include &lt;hiredis/hiredis.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

void printReply(redisReply *reply) {
    switch (reply->type) {
        case REDIS_REPLY_STRING:
            printf("STRING: %s\n", reply->str);
            break;
        case REDIS_REPLY_ARRAY:
            printf("ARRAY (%zu elements):\n", reply->elements);
            for (size_t i = 0; i &lt; reply->elements; i++) {
                printf("  [%zu] ", i);
                printReply(reply->element[i]);
            }
            break;
        case REDIS_REPLY_INTEGER:
            printf("INTEGER: %lld\n", reply->integer);
            break;
        case REDIS_REPLY_NIL:
            printf("NIL\n");
            break;
        case REDIS_REPLY_STATUS:
            printf("STATUS: %s\n", reply->str);
            break;
        case REDIS_REPLY_ERROR:
            printf("ERROR: %s\n", reply->str);
            break;
        default:
            printf("UNKNOWN type: %d\n", reply->type);
    }
}

int main() {
    redisContext *c = redisConnect("127.0.0.1", 6379);
    if (c == NULL || c->err) return 1;

    // è®¾ç½®ä¸€äº›æ•°æ®
    redisCommand(c, "SET key1 value1");
    redisCommand(c, "LPUSH list1 a b c d e");

    // æµ‹è¯•ä¸åŒç±»å‹çš„å›å¤
    redisReply *reply;

    // STRING
    reply = (redisReply *)redisCommand(c, "GET key1");
    printf("GET key1: ");
    printReply(reply);
    freeReplyObject(reply);

    // INTEGER
    reply = (redisReply *)redisCommand(c, "LLEN list1");
    printf("LLEN list1: ");
    printReply(reply);
    freeReplyObject(reply);

    // ARRAY
    reply = (redisReply *)redisCommand(c, "LRANGE list1 0 -1");
    printf("LRANGE list1: ");
    printReply(reply);
    freeReplyObject(reply);

    // NIL
    reply = (redisReply *)redisCommand(c, "GET nonexistent");
    printf("GET nonexistent: ");
    printReply(reply);
    freeReplyObject(reply);

    redisFree(c);
    return 0;
}</code></pre>

        <h2>ğŸ’¼ å®é™…åº”ç”¨ç¤ºä¾‹</h2>

        <h3>ç®€å•çš„ç¼“å­˜å°è£…</h3>
        <pre><code>#include &lt;hiredis/hiredis.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

class RedisCache {
private:
    redisContext *context_;

public:
    RedisCache(const char *host = "127.0.0.1", int port = 6379) {
        context_ = redisConnect(host, port);
        if (context_ == NULL || context_->err) {
            printf("Redis connection failed\n");
            context_ = NULL;
        }
    }

    ~RedisCache() {
        if (context_) {
            redisFree(context_);
        }
    }

    bool isConnected() const {
        return context_ != NULL;
    }

    bool set(const char *key, const char *value, int seconds = 0) {
        redisReply *reply;
        if (seconds &gt; 0) {
            reply = (redisReply *)redisCommand(context_, "SETEX %s %d %s", key, seconds, value);
        } else {
            reply = (redisReply *)redisCommand(context_, "SET %s %s", key, value);
        }

        bool success = (reply->type == REDIS_REPLY_STATUS);
        freeReplyObject(reply);
        return success;
    }

    bool get(const char *key, char *buffer, size_t buffer_size) {
        redisReply *reply = (redisReply *)redisCommand(context_, "GET %s", key);
        
        bool success = false;
        if (reply->type == REDIS_REPLY_STRING && reply->len &lt; buffer_size) {
            strncpy(buffer, reply->str, buffer_size);
            success = true;
        }
        
        freeReplyObject(reply);
        return success;
    }

    bool del(const char *key) {
        redisReply *reply = (redisReply *)redisCommand(context_, "DEL %s", key);
        bool success = (reply->integer &gt; 0);
        freeReplyObject(reply);
        return success;
    }
};

int main() {
    RedisCache cache;

    if (!cache.isConnected()) {
        printf("Failed to connect to Redis\n");
        return 1;
    }

    // è®¾ç½®ç¼“å­˜ï¼ˆ10ç§’è¿‡æœŸï¼‰
    cache.set("user:1001", "{\"name\":\"Alice\",\"age\":25}", 10);

    // è·å–ç¼“å­˜
    char value[256];
    if (cache.get("user:1001", value, sizeof(value))) {
        printf("Cached data: %s\n", value);
    }

    return 0;
}</code></pre>

        <h2>ğŸ“‹ Redis å›å¤ç±»å‹é€ŸæŸ¥</h2>

        <table>
            <thead>
                <tr>
                    <th>ç±»å‹å¸¸é‡</th>
                    <th>æ•°å€¼</th>
                    <th>è¯´æ˜</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>REDIS_REPLY_STRING</code></td>
                    <td>1</td>
                    <td>å­—ç¬¦ä¸²</td>
                </tr>
                <tr>
                    <td><code>REDIS_REPLY_ARRAY</code></td>
                    <td>2</td>
                    <td>æ•°ç»„</td>
                </tr>
                <tr>
                    <td><code>REDIS_REPLY_INTEGER</code></td>
                    <td>3</td>
                    <td>æ•´æ•°</td>
                </tr>
                <tr>
                    <td><code>REDIS_REPLY_NIL</code></td>
                    <td>4</td>
                    <td>ç©ºå€¼</td>
                </tr>
                <tr>
                    <td><code>REDIS_REPLY_STATUS</code></td>
                    <td>5</td>
                    <td>çŠ¶æ€</td>
                </tr>
                <tr>
                    <td><code>REDIS_REPLY_ERROR</code></td>
                    <td>6</td>
                    <td>é”™è¯¯</td>
                </tr>
            </tbody>
        </table>

        <div class="note">
            <strong>ğŸ’¡ æç¤ºï¼š</strong> hiredis æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œæ¯ä¸ªçº¿ç¨‹åº”è¯¥æœ‰è‡ªå·±çš„ redisContextï¼Œæˆ–è€…ä½¿ç”¨è¿æ¥æ± ã€‚
        </div>

        <div class="warning">
            <strong>âš ï¸ æ³¨æ„ï¼š</strong> 
            <ul>
                <li>æ¯æ¬¡è°ƒç”¨ redisCommand æˆ– redisCommandArgv åå¿…é¡»è°ƒç”¨ freeReplyObject é‡Šæ”¾å†…å­˜</li>
                <li>ä½¿ç”¨å®Œæ¯•åå¿…é¡»è°ƒç”¨ redisFree é‡Šæ”¾è¿æ¥</li>
                <li>æ£€æŸ¥è¿æ¥çŠ¶æ€å’Œé”™è¯¯ç ï¼ˆc->errï¼‰</li>
                <li>å¼‚æ­¥æ¨¡å¼éœ€è¦é…åˆ libevent æˆ–å…¶ä»–äº‹ä»¶å¾ªç¯åº“ä½¿ç”¨</li>
            </ul>
        </div>

        <h2>ğŸ”— å‚è€ƒèµ„æ–™</h2>
        <ul>
            <li><a href="https://github.com/redis/hiredis" target="_blank" style="color: #4cd1a8;">hiredis GitHub</a></li>
            <li><a href="https://redis.com/redis-enterprise/technology/redis-clients/" target="_blank" style="color: #4cd1a8;">Redis å®¢æˆ·ç«¯æ–‡æ¡£</a></li>
        </ul>

        <!-- é¡µè„š -->
        <footer>
            <p class="footer-text">&copy; 2026 C++ å¼€æºåº“ç²¾é€‰åŸºåœ°. ç‰ˆæƒæ‰€æœ‰Â·LEVI</p>
            <p class="footer-text">å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»: <a href="mailto:373102227@qq.com" class="contact-link">373102227@qq.com</a></p>
        </footer>
    </div>
</body>
</html>
